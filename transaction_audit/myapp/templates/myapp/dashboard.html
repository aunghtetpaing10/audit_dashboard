<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transaction Dashboard</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body
    class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 font-['Inter']"
  >
    <div class="container mx-auto px-4 py-12 max-w-7xl">
      <div class="text-center mb-14">
        <h1
          class="text-5xl font-bold bg-gradient-to-r from-blue-600 to-indigo-500 bg-clip-text text-transparent mb-3"
        >
          Transaction Dashboard
        </h1>
        <p class="text-slate-500">Monitor and analyze transaction patterns</p>
      </div>

      <div
        class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 transition-all duration-300 hover:shadow-2xl border border-white/20"
      >
        <!-- Filters -->
        <div
          class="grid grid-cols-1 md:grid-cols-3 xl:grid-cols-4 gap-5 mb-8"
          id="filter-controls"
        >
          <div class="space-y-2">
            <label class="text-sm font-medium text-slate-700">Status</label>
            <div class="relative">
              <select
                id="status"
                name="status"
                class="w-full pl-4 pr-10 py-3 rounded-xl border-0 bg-slate-50/80 shadow-sm ring-1 ring-slate-200/60 focus:ring-2 focus:ring-blue-500 placeholder-slate-400 transition-all duration-200"
                hx-get="{% url 'dashboard' %}"
                hx-target="#transactions-content"
                hx-trigger="change"
                hx-include="[name='merchant']"
                hx-push-url="true"
              >
                <option value="">All Status</option>
                <option value="pending" {% if request.GET.status == 'pending' %}selected{% endif %}>Pending</option>
                <option value="completed" {% if request.GET.status == 'completed' %}selected{% endif %}>Completed</option>
                <option value="failed" {% if request.GET.status == 'failed' %}selected{% endif %}>Failed</option>
              </select>
              <div class="absolute right-3 top-3.5 text-slate-400">
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  />
                </svg>
              </div>
            </div>
          </div>

          <div class="space-y-2">
            <label class="text-sm font-medium text-slate-700"
              >Search Merchant</label
            >
            <div class="relative">
              <input
                type="text"
                id="merchant"
                name="merchant"
                class="w-full pl-4 pr-10 py-3 rounded-xl border-0 bg-slate-50/80 shadow-sm ring-1 ring-slate-200/60 focus:ring-2 focus:ring-blue-500 placeholder-slate-400 transition-all duration-200"
                placeholder="Search..."
                value="{{ request.GET.merchant|default:'' }}"
                hx-get="{% url 'dashboard' %}"
                hx-target="#transactions-content"
                hx-trigger="keyup changed delay:500ms"
                hx-include="[name='status']"
                hx-push-url="true"
              />
              <svg
                class="absolute right-3 top-3.5 w-5 h-5 text-slate-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
            </div>
          </div>

          <div class="flex items-end">
            <button
              class="w-full px-5 py-3 rounded-xl bg-white shadow-sm ring-1 ring-slate-200/60 hover:ring-blue-500 text-slate-600 hover:text-blue-600 transition-all duration-200 font-medium flex items-center justify-center gap-2"
              hx-get="{% url 'dashboard' %}"
              hx-target="#transactions-content"
              hx-push-url="true"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                />
              </svg>
              Reset Filters
            </button>
          </div>
        </div>

        <!-- Table -->
        <div id="transactions-table" class="relative">
          <div id="transactions-content">
            <div
              class="htmx-indicator absolute inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center rounded-2xl pointer-events-none"
            >
              <div class="animate-pulse flex items-center gap-3 text-slate-500">
                <div
                  class="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"
                ></div>
                Loading...
              </div>
            </div>
            <table
              class="w-full divide-y divide-slate-200/60 rounded-xl overflow-hidden"
            >
              <thead class="bg-slate-50/80 backdrop-blur-sm">
                <tr>
                  <th
                    class="px-6 py-4 text-left text-sm font-semibold text-slate-700"
                  >
                    Merchant
                  </th>
                  <th
                    class="px-6 py-4 text-left text-sm font-semibold text-slate-700"
                  >
                    Amount
                  </th>
                  <th
                    class="px-6 py-4 text-left text-sm font-semibold text-slate-700"
                  >
                    Status
                  </th>
                  <th
                    class="px-6 py-4 text-left text-sm font-semibold text-slate-700"
                  >
                    Flagged
                  </th>
                  <th
                    class="px-6 py-4 text-left text-sm font-semibold text-slate-700"
                  >
                    Approved By
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-200/60">
                {% for transaction in transactions %}
                <tr class="hover:bg-slate-50/50 transition-colors duration-150">
                  <td class="px-6 py-4 text-sm font-medium text-slate-900">
                    {{ transaction.merchant }}
                  </td>
                  <td class="px-6 py-4 text-sm text-slate-900 font-mono">
                    ${{ transaction.amount }}
                  </td>
                  <td class="px-6 py-4">
                    <span
                      class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium {% if transaction.status == 'completed' %}bg-emerald-100 text-emerald-800 {% elif transaction.status == 'failed' %}bg-rose-100 text-rose-800 {% else %}bg-amber-100 text-amber-800{% endif %}"
                    >
                      {{ transaction.status|title }}
                    </span>
                  </td>
                  <td class="px-6 py-4">
                    {% if transaction.is_flagged %}
                    <span
                      class="inline-flex items-center gap-1.5 text-rose-600"
                    >
                      <svg
                        class="w-4 h-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                        />
                      </svg>
                      Flagged
                    </span>
                    {% else %}
                    <span class="text-slate-400">-</span>
                    {% endif %}
                  </td>
                  <td class="px-6 py-4 text-sm text-slate-500">
                    {{ transaction.approved_by|default:"-" }}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>

            <!-- Pagination -->
            {% if is_paginated %}
            <div class="mt-6 flex items-center justify-between">
              <div class="hidden sm:block">
                <p class="text-sm text-slate-500">
                  Showing
                  <span class="font-medium">{{ page_obj.start_index }}</span> to
                  <span class="font-medium">{{ page_obj.end_index }}</span> of
                  <span class="font-medium">{{ page_obj.paginator.count }}</span>
                  results
                </p>
              </div>
              <nav class="flex items-center gap-1">
                {% if page_obj.has_previous %}
                <a
                  href="?page={{ page_obj.previous_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.merchant %}&merchant={{ request.GET.merchant }}{% endif %}"
                  class="p-2 rounded-lg hover:bg-slate-100 transition-colors cursor-pointer"
                  hx-get="{% url 'dashboard' %}?page={{ page_obj.previous_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.merchant %}&merchant={{ request.GET.merchant }}{% endif %}"
                  hx-target="#transactions-content"
                  hx-push-url="true"
                >
                  <svg
                    class="w-5 h-5 text-slate-500"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 19l-7-7 7-7"
                    />
                  </svg>
                </a>
                {% endif %}
                {% if page_obj.number > 3 %}
                <a
                  href="?page=1{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.merchant %}&merchant={{ request.GET.merchant }}{% endif %}"
                  class="px-3 py-2 rounded-lg text-slate-600 hover:bg-slate-100 text-sm transition-colors cursor-pointer"
                  hx-get="{% url 'dashboard' %}?page=1{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.merchant %}&merchant={{ request.GET.merchant }}{% endif %}"
                  hx-target="#transactions-content"
                  hx-push-url="true"
                >
                  {{ page_obj.paginator.num_pages }}
                </a>
                {% endif %}
                {% for i in page_obj.paginator.page_range %}
                    {% if i >= page_obj.number|add:-2 and i <= page_obj.number|add:2 %}
                        {% if page_obj.number == i %}
                            <span class="px-3 py-2 rounded-lg bg-blue-500 text-white text-sm font-medium">{{ i }}</span>
                        {% else %}
                            <a href="?page={{ i }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.merchant %}&merchant={{ request.GET.merchant }}{% endif %}" class="px-3 py-2 rounded-lg text-slate-600 hover:bg-slate-100 text-sm transition-colors cursor-pointer" hx-get="{% url 'dashboard' %}?page={{ i }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.merchant %}&merchant={{ request.GET.merchant }}{% endif %}" hx-target="#transactions-content" hx-push-url="true">{{ i }}</a>
                        {% endif %}
                    {% endif %}
                {% endfor %}
                {% if page_obj.number < page_obj.paginator.num_pages|add:-2 %}
                <span class="px-2 text-slate-400">...</span>
                <a
                  href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.merchant %}&merchant={{ request.GET.merchant }}{% endif %}"
                  class="px-3 py-2 rounded-lg text-slate-600 hover:bg-slate-100 text-sm transition-colors cursor-pointer"
                  hx-get="{% url 'dashboard' %}?page={{ page_obj.paginator.num_pages }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.merchant %}&merchant={{ request.GET.merchant }}{% endif %}"
                  hx-target="#transactions-content"
                  hx-push-url="true"
                >
                  {{ page_obj.paginator.num_pages }}
                </a>
                {% endif %}
                {% if page_obj.has_next %}
                <a
                  href="?page={{ page_obj.next_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.merchant %}&merchant={{ request.GET.merchant }}{% endif %}"
                  class="p-2 rounded-lg hover:bg-slate-100 transition-colors cursor-pointer"
                  hx-get="{% url 'dashboard' %}?page={{ page_obj.next_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.merchant %}&merchant={{ request.GET.merchant }}{% endif %}"
                  hx-target="#transactions-content"
                  hx-push-url="true"
                >
                  <svg
                    class="w-5 h-5 text-slate-500"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"
                    />
                  </svg>
                </a>
                {% endif %}
              </nav>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <style>
      .htmx-indicator {
        opacity: 0;
        transition: opacity 0.2s ease;
        pointer-events: none;
        z-index: 10;
      }
      .htmx-request .htmx-indicator {
        opacity: 1;
      }
      tbody tr {
        transition: transform 0.2s ease, background-color 0.2s ease;
      }
      tbody tr:hover {
        transform: translateX(4px);
      }
      thead {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
      }
    </style>
  </body>
</html>
